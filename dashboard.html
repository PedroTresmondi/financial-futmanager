<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script>document.addEventListener('contextmenu', function (e) { e.preventDefault(); });</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard – Análise de partidas</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/panel.css">
  <link rel="stylesheet" href="/styles/idle.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dashboard-root { height: 100vh; max-height: 100dvh; overflow: hidden; display: flex; flex-direction: column; }
    .dashboard-main { flex: 1; min-height: 0; overflow: hidden; display: grid; gap: 0.5rem; padding: 0.5rem; grid-template-columns: repeat(1, 1fr); grid-template-rows: auto auto 1fr 1fr; grid-auto-rows: minmax(0, 1fr); }
    @media (min-width: 768px) {
      .dashboard-main { grid-template-columns: repeat(2, 1fr); grid-template-rows: auto auto 1fr 1fr; }
    }
    @media (min-width: 1280px) {
      .dashboard-main { grid-template-columns: repeat(3, 1fr); grid-template-rows: auto 1fr 1fr; }
    }
    .dashboard-section { min-height: 0; display: flex; flex-direction: column; background: rgb(30 41 59); border: 1px solid rgb(51 65 85); border-radius: 0.5rem; overflow: hidden; }
    .dashboard-section-head { flex-shrink: 0; padding: 0.375rem 0.5rem; }
    .dashboard-section-body { flex: 1; min-height: 0; overflow: auto; }
    .dashboard-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.25rem; }
    @media (min-width: 640px) { .dashboard-stats { grid-template-columns: repeat(5, 1fr); } }
    .dashboard-stat { padding: 0.25rem 0.375rem; border-radius: 0.25rem; background: rgba(15, 23, 42, 0.7); border: 1px solid rgb(51 65 85); text-align: center; }
    .dashboard-stat-num { font-size: 1rem; font-weight: 700; line-height: 1.2; }
    .dashboard-stat-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: rgb(148 163 184); }
  </style>
  <script defer src="/src/dashboard.js"></script>
</head>
<body class="panel-page dashboard-root bg-slate-900 text-slate-100 font-sans text-xs">
  <header class="flex-shrink-0 px-3 py-2 flex justify-between items-center border-b border-slate-700">
    <h1 class="text-lg font-bold text-violet-400 italic truncate">Dashboard</h1>
    <a href="/admin.html" class="text-slate-400 hover:text-emerald-400 font-bold uppercase tracking-wide transition shrink-0">← Admin</a>
  </header>

  <main class="dashboard-main">
    <div id="dashboard-loading" class="col-span-full flex items-center justify-center py-8 text-slate-400">Carregando partidas...</div>
    <div id="dashboard-content" class="hidden contents col-span-full">
      <!-- Resumo: ocupa linha inteira -->
      <section class="dashboard-section col-span-full">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Resumo geral</h2>
        </div>
        <div class="dashboard-section-body px-2 pb-2">
          <div class="dashboard-stats">
            <div class="dashboard-stat">
              <div class="dashboard-stat-num text-white" id="stat-total-games">0</div>
              <div class="dashboard-stat-label">Partidas</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-num text-cyan-400" id="stat-unique-names">0</div>
              <div class="dashboard-stat-label">Jogadores únicos</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-num text-blue-400" id="stat-conservador">0</div>
              <div class="dashboard-stat-label">Conservador</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-num text-amber-400" id="stat-moderado">0</div>
              <div class="dashboard-stat-label">Moderado</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-num text-red-400" id="stat-arrojado">0</div>
              <div class="dashboard-stat-label">Arrojado</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Métricas por perfil -->
      <section class="dashboard-section">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Métricas por perfil</h2>
        </div>
        <div class="dashboard-section-body overflow-x-auto">
          <table class="w-full text-left min-w-[200px]">
            <thead class="bg-slate-900 text-slate-400 uppercase">
              <tr>
                <th class="p-1.5">Perfil</th>
                <th class="p-1.5 text-right">N</th>
                <th class="p-1.5 text-right">Média</th>
                <th class="p-1.5 text-right">Acerto</th>
              </tr>
            </thead>
            <tbody id="table-by-profile-metrics"></tbody>
          </table>
        </div>
      </section>

      <!-- Matriz investimento × perfil -->
      <section class="dashboard-section">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Matriz ativo × perfil</h2>
        </div>
        <div class="dashboard-section-body overflow-x-auto">
          <table class="w-full text-left min-w-[240px]">
            <thead class="bg-slate-900 text-slate-400 uppercase">
              <tr>
                <th class="p-1.5 text-left">Ativo</th>
                <th class="p-1 text-center">Cons.</th>
                <th class="p-1 text-center">Mod.</th>
                <th class="p-1 text-center">Arroj.</th>
                <th class="p-1 text-center">Σ</th>
              </tr>
            </thead>
            <tbody id="matrix-asset-profile-body"></tbody>
          </table>
        </div>
      </section>

      <!-- Por usuário -->
      <section class="dashboard-section">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Partidas por jogador</h2>
        </div>
        <div class="dashboard-section-body overflow-x-auto">
          <table class="w-full text-left min-w-[180px]">
            <thead class="bg-slate-900 text-slate-400 uppercase">
              <tr>
                <th class="p-1.5">Jogador</th>
                <th class="p-1.5 text-right">N</th>
                <th class="p-1.5 text-right">Média</th>
              </tr>
            </thead>
            <tbody id="table-by-user" class="divide-y divide-slate-700"></tbody>
          </table>
        </div>
      </section>

      <!-- Mapa de calor -->
      <section class="dashboard-section">
        <div class="dashboard-section-head flex flex-wrap items-center gap-1.5">
          <h2 class="font-bold text-sm">Mapa de calor (zona)</h2>
          <div class="flex flex-wrap gap-1">
            <button type="button" class="heatmap-filter-btn px-2 py-0.5 rounded text-xs font-bold transition bg-violet-600 text-white" data-profile="ALL">Todos</button>
            <button type="button" class="heatmap-filter-btn px-2 py-0.5 rounded text-xs font-bold transition bg-slate-700 text-slate-300 hover:bg-slate-600" data-profile="CONSERVADOR">Cons.</button>
            <button type="button" class="heatmap-filter-btn px-2 py-0.5 rounded text-xs font-bold transition bg-slate-700 text-slate-300 hover:bg-slate-600" data-profile="MODERADO">Mod.</button>
            <button type="button" class="heatmap-filter-btn px-2 py-0.5 rounded text-xs font-bold transition bg-slate-700 text-slate-300 hover:bg-slate-600" data-profile="ARROJADO">Arroj.</button>
          </div>
        </div>
        <div class="dashboard-section-body overflow-x-auto">
          <table class="w-full text-left min-w-[200px]">
            <thead class="bg-slate-900 text-slate-400 uppercase">
              <tr>
                <th class="p-1.5 text-left">Ativo</th>
                <th class="p-1 text-center">Def.</th>
                <th class="p-1 text-center">Meio</th>
                <th class="p-1 text-center">Atq.</th>
              </tr>
            </thead>
            <tbody id="heatmap-body"></tbody>
          </table>
        </div>
      </section>

      <!-- Top ativos por zona -->
      <section class="dashboard-section">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Top ativos por zona</h2>
        </div>
        <div class="dashboard-section-body overflow-auto px-2 pb-2">
          <div class="grid grid-cols-3 gap-2">
            <div>
              <h3 class="font-bold text-blue-400 uppercase text-[0.65rem] mb-0.5">Defesa</h3>
              <ul id="top-defense-list" class="space-y-0.5"></ul>
            </div>
            <div>
              <h3 class="font-bold text-amber-400 uppercase text-[0.65rem] mb-0.5">Meio</h3>
              <ul id="top-midfield-list" class="space-y-0.5"></ul>
            </div>
            <div>
              <h3 class="font-bold text-red-400 uppercase text-[0.65rem] mb-0.5">Ataque</h3>
              <ul id="top-attack-list" class="space-y-0.5"></ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Partidas por dia -->
      <section class="dashboard-section">
        <div class="dashboard-section-head">
          <h2 class="font-bold text-sm">Partidas por dia (30d)</h2>
        </div>
        <div class="dashboard-section-body overflow-x-auto">
          <table class="w-full text-left min-w-[140px]">
            <thead class="bg-slate-900 text-slate-400 uppercase">
              <tr>
                <th class="p-1.5">Data</th>
                <th class="p-1.5 text-right">N</th>
              </tr>
            </thead>
            <tbody id="table-by-day"></tbody>
          </table>
        </div>
      </section>
    </div>
    <div id="dashboard-error" class="hidden col-span-full text-center py-8 text-red-400"></div>
  </main>
</body>
</html>